language: python

python:
  - "2.7"
  - "3.6"

before_install:
  - travis_wait 20 if [[ $TRAVIS_PYTHON_VERSION == '2.7' ]]; then bash bin/install_pyqt4.sh; fi
  - travis_wait 20 if [[ $TRAVIS_PYTHON_VERSION == '3'* ]]; then bash bin/install_pyqt5.sh; fi

install:
  - if [[ $TRAVIS_PYTHON_VERSION == '2.7' ]]; then sudo apt-get install mesa-common-dev; fi
  - if [[ $TRAVIS_PYTHON_VERSION == '2.7' ]]; then travis_retry python -m pip install -r requirements_python2.txt pytest==4.0.1 pytest-xvfb PyYAML pylint==2.4.4; fi
  - if [[ $TRAVIS_PYTHON_VERSION == '3'* ]]; then travis_retry pip3 install -r requirements_python3.txt pytest==4.0.1 pytest-xvfb PyYAML pylint==2.4.4; fi

before_script:
  - "export DISPLAY=:99.0"

script:
  - cd test
  - travis_wait 20 if [[ $TRAVIS_PYTHON_VERSION == '2.7' ]]; then python -m pytest; fi
  - travis_wait 20 if [[ $TRAVIS_PYTHON_VERSION == '3'* ]]; then python3 -m pytest; fi
  - cd ..
  - pylint -E gui --extension-pkg-whitelist=PyQt5,PyQt4
