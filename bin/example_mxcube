#!/usr/bin/env bash

#  DESCRIPTION
#  --------------
#
#  Generic startup script for any mxcube application using Qt4
#

#  ENVIRONMENT
#  --------------
#  The following environment variables are needed
#
#    INSTITUTE   ( ALBA, SOLEIL... )
#    MXCUBE_INSTALL - directory with mxcube installation
#    MXCUBE_LOCAL   - directory containing local files including:
#            HardwareObjects.xml
#            "*gui" files
#            log/ directory

#  RUNNING MXCUBE
#  -----------------
#  To run mxcube for the first time after installation:
#     cd <mxcube_install_dir>
#     cp bin/example_mxcube $HOME/bin/mxcube
#     cp example_mxcube_qt4.gui <mxcube_local_dir>/mxcube.gui
#     [ create and adapt $HOME/.mxcube_rc to reflect your env variables ]
#        see provided example_mxcube_rc for guidance
#     cd 
#     mxcube

#  CREATING A NEW GUI
#  -------------------
#  To have a new application simply copy this file to your bin directory 
#  with the name of the desired application <application_name>
#  If you have an initial GUI file place it with name <application_name>.gui 
#  in the MXCUBE_LOCAL directory

#  EXAMPLE .mxcube_rc
#  --------------------
#     
#  | export INSTITUTE=ALBA
#  | export MXCUBE_LOCAL=/homelocal/sicilia/MXCuBE
#  | export MXCUBE_INSTALL=/homelocal/sicilia/MXCuBE/mxcube
#  | 
#  | # include other local specific python code needed by MXCuBE
#  | export PYTHONPATH=$PYTHONPATH:/beamlines/bl13/controls/devel/git
#  | source /homelocal/sicilia/etc/Lima/BASLER.rc
#  

source $HOME/.mxcube_rc

LOGS_DIR=$MXCUBE_LOCAL/log
XML_DIR=$MXCUBE_LOCAL/HardwareObjects.xml

APP_NAME=`basename "$0"`
GUI_FILE=$MXCUBE_LOCAL/$APP_NAME.gui

export PYTHONPATH=$PYTHONPATH:$MXCUBE_INSTALL:$MXCUBE_INSTALL/Bricks:$MXCUBE_INSTALL/Bricks/$INSTITUTE
export PYTHONPATH=$PYTHONPATH:$MXCUBE_INSTALL/HardwareObjects:$MXCUBE_INSTALL/HardwareObjects/$INSTITUTE

export BRICKS_PATH=$MXCUBE_INSTALL/Bricks

$MXCUBE_INSTALL/bin/Qt4_startGUI --hardwareRepository=$XML_DIR --bricksDir=$BRICKS_PATH \
            --logFile=$LOGS_DIR/$APP_NAME-$USER.log \
            $GUI_FILE $* > $LOGS_DIR/$APP_NAME-$USER.out 2> $LOGS_DIR/$APP_NAME-$USER.err

